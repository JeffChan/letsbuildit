<!DOCTYPE html>
<html lang="en">
<head>
	<title>Ballz</title>
	<link rel="stylesheet" type="text/css" href="c/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="c/slider.css" />
	<link rel="stylesheet" type="text/css" href="c/style.css" />

	<script type="text/javascript" src="j/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="j/bootstrap.min.js"></script>
	<script type="text/javascript" src="j/bootstrap-slider.js"></script>

	<script type="text/javascript" src="j/underscore-min.js"></script>
	<script type="text/javascript" src="j/three.min.js"></script>
	<script type="text/javascript" src="j/csg.js"></script>
	<script type="text/javascript" src="j/ThreeCSG.js"></script>
	<script type="text/javascript" src="j/TrackballControls.js"></script>
	<script type="text/javascript" src="j/GeometryExporter.js"></script>
	<script type="text/javascript" src="j/FileSaver.min.js"></script>

	<script type="text/javascript" src="j/app.js"></script>

	<script type="text/javascript">

	window.levels = {
		0: {
			time: 10*60*60, // in seconds
			series: [
				{
					url: 't/example1.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				},
				{
					url: 't/example1.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				}
			]
		},
		1: {
			time: 15*60*60, // in seconds
			series: [
				{
					url: 't/example2.json',
					time: 500
				},
				{
					url: 't/example1.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				}
			]
		},
		2: {
			time: 20*60*60, // in seconds
			series: [
				{
					url: 't/example1.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				},
				{
					url: 't/example1.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				},
				{
					url: 't/example2.json',
					time: 500
				}
			]
		}
	};

	function setViewAll(view) {
		window.app.setView(view);
		window.demo.setView(view);
	}

	$(function() {

		// $('#help').modal();

		window.timer = new Timer({
			barContainer: '#timerBar',
			textContainer: '#timerText',
			startTime: 10 * 60 * 60 // in seconds
		});

		window.app = new App({
			htmlContainer: '#sandbox',
			width: 460,
			height: 345
		});

		window.demo = new App({
			htmlContainer: '#exhibit',
			width: 300,
			height: 225,
			locked: true
		});

		app.loadSample();

		$('#done').on('click', function(e) {
			e.preventDefault();
			app.next();
		});
		$('#reset').on('click', function(e) {
			e.preventDefault();
			app.reset();
		});
		$('#undo').on('click', function(e) {
			e.preventDefault();
			app.undo();
		});
		$('#export').on('click', function(e) {
			e.preventDefault();
			app.export(true);
		});
		$('#file').on('change', function(e) {
			var file = e.target.files[0];
			var reader = new FileReader();
			reader.onload = (function(theFile) {
				return function(e) {
					demo.redrawPiece(demo.import(e.target.result));
				}
			})(file);
			reader.readAsText(file);
		});

		$('a.tool').on('click', function(e) {
			e.preventDefault();
			var $tool = $(e.target);
			var id = $tool.attr('id');
			$('#currentTool').text($tool.text());
			app.setMode(id);

			$('body').removeClass('selected-mill selected-drill selected-saw').addClass('selected-'+id);

			$('a.tool').each(function(i, el) {
				$(el).removeClass('btn-info');
			});
			$tool.addClass('btn-info');
		});

		var descriptions = {
			mill: 'mill is the bomb',
			saw: 'saw is the bomb',
			drill: 'drill is the bomb'
		};
		$('a.tool').each(function(i, el) {
			var $tool = $(el);
			var i = $tool.attr('id');
			$tool.popover({
				trigger: 'hover focus',
				container: $tool[0],
				title: $tool.text(),
				content: descriptions[i]
			});
		});

		$('.disabled-tool').popover({
			trigger: 'hover focus',
			title: 'Not Available',
			content: 'This tool is not available for noobs!'
		});

		$('#gridToggle').on('click', function(e) {
			e.preventDefault();
			var el = $(this);
			var state = el.data('state');
			switch (state) {
				case 'show' :
					app.showGrid(true);
					demo.showGrid(true);
					el.data('state', 'hide');
					el.find('span').text('Hide Grid');
					break;
				case 'hide' :
					app.showGrid(false);
					demo.showGrid(false);
					el.data('state', 'show');
					el.find('span').text('Show Grid');
					break;
			}
		});

		$("#radius").slider({
			value: 6,
			min: 2,
			max: 12,
			step: 2
		}).on('slideStop', function(e) {
			app.radius = e.value;
		});

		$("#depth").slider({
			value: 10,
			min: 2,
			max: 100,
			step: 4
		}).on('slideStop', function(e) {
			app.depth = e.value;
		});

		$('#cutInverse').on('change', function(e) {
			if (this.checked) {
				app.cutInverse = true;
			} else {
				app.cutInverse = false;
			}
		});

		$('.change-view').on('click', function(e) {
			var $el = $(this);
			var view = $el.attr('id');
			setViewAll(view);
		});
	});

	</script>
</head>

<body>

<div id="outoftime" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h2>Out of Time!</h2>
	</div>
	<div class="modal-body">
		<p>You ran out of time! Try thinking about the order of operation. Remember "measure twice, cut once!"</p>
	</div>
	<div class="modal-footer">
		<button class="btn btn-warning" data-dismiss="modal" aria-hidden="true">Restart</button>
	</div>
</div>

<div id="levelComplete" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h2>Level Completed!</h2>
	</div>
	<div class="modal-body">
		<h3>Score <span class="rating"></span></h3>
		<h3>Breakdown</h3>
		<table class="table table-bordered table-striped table-hover">
		<thead>
			<tr>
				<th>Sample</th>
				<th>Your Time (seconds)</th>
				<th>Target Time (seconds)</th>
			</tr>
		</thead>
		<tbody id="breakdown">
			<tr>
				<td>1</td>
				<td class="yours">Mark</td>
				<td class="official">Otto</td>
			</tr>
			<tr>
				<td>2</td>
				<td class="yours">Mark</td>
				<td class="official">Otto</td>
			</tr>
			<tr>
				<td>3</td>
				<td class="yours">Mark</td>
				<td class="official">Otto</td>
			</tr>
			<tr>
				<td>4</td>
				<td class="yours">Mark</td>
				<td class="official">Otto</td>
			</tr>
			<tr>
				<td>5</td>
				<td class="yours">Mark</td>
				<td class="official">Otto</td>
			</tr>
		</tbody>
		</table>
	</div>
	<div class="modal-footer">
		<button class="btn btn-success" data-dismiss="modal" aria-hidden="true">Next Level</button>
	</div>
</div>

<div id="about" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h2>About</h2>
	</div>
	<div class="modal-body">
		<p><strong>Let's Build It</strong> is a 3D game that simulating the machining processes related to mechanical engineering created as a final project for the MIT class 11.127 &mdash; Computer Games and Simulations for Investigation and Education. It uses Three.js, a JavaScript WebGL library for 3D graphics in a web browser. It is developed for classrooms where actual machinery is not readily available for student use and experiment.</p>
		<p>Players are able to simulate applying different tools to an object of a certain material to construct objects matching the assigned machining job. The goals are to teach process engineering, tool familiarity, relative machine operation times.</p>
		<p>It’s currently in the pre-Alpha stage where it is playable but still lacking a few tools and models.</p>

		<h3>Developers</h3>
		<p>Alejandro Aguirre, Jeff Chan, Jessica Chen, Tavish Smith, and Quantum Wei</p>
	</div>
</div>

<div id="help" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h2>Instructions</h2>
	</div>
	<div class="modal-body">
		<h3>Functions</h3>
		<p><strong>View Rotation:</strong> To rotate the object, hold down the mouse within the workspace but outside of the object and move your mouse around. There are shortcut views of isometric, top, right and front.</p>
		<p><strong>Object Zoom:</strong> To zoom in and out, scroll up and down.</p>
		<p><strong>Object Grid:</strong> Click the “Show/Hide Grid” button to toggle between the two views.</p>
		<p><strong>Download:</strong> To download the finished project file, click the “Download” button.</p>
		<p><strong>Submit:</strong> To submit a completed project, click the “I’m Done!” button.</p>

		<h3>Tools</h3>
		<h4>Drill Press</h4>
		<ol>
			<li>Use the radius slider to change the size of drill bit.</li>
			<li>Hover over the spot you want to drill and mouse click to drill.</li>
		</ol>
		<h4>Mill</h4>
		<ol>
			<li>Use the radius slider to change the size of the end mill.</li>
			<li>Use the depth slider to change the depth of cut.</li>
			<li>To mill a slot: Click the start point and then click the end point.</li>
			<li>To mill a hole: Double click</li>
		</ol>
		<h4>Band Saw</h4>
		<ol>
			<li>Use the “Cut Inverse to determine where the vector bisecting the side to be discarded will point.</li>
			<li>Hover over a face that is perpendicular to the plane of the cut to be made.</li>
			<li>Mouse click to make the cut.</li>
		</ol>
	</div>
	<div class="modal-footer">
		<button class="btn btn-success" data-dismiss="modal" aria-hidden="true">I'm Ready to Play!</button>
	</div>
</div>

<div class="wrapper">
	<div class="navbar navbar-inverse"><div class="navbar-inner">
		<span class="brand">Let's Build It</span>
		<div class="nav-collapse">
			<ul class="nav">
				<li><a href="#">Level <span id="curLevel">1</span>&nbsp;&nbsp;
					Sample #<span id="curSample">1</span></a></li>
			</ul>
			<ul class="nav pull-right">
				<!-- <li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">Options <b class="caret"></b></a>
					<ul class="dropdown-menu">
						<li><a href="#" id="export">Download</a></li>
					</ul>
				</li> -->
				<li><a href="#" data-toggle="modal" data-target="#help">Instructions</a></li>
				<li><a href="#" data-toggle="modal" data-target="#about">About</a></li>
			</ul>
		</div>
	</div></div>

	<div class="belly">

	<div class="row">
		<div class="tools span2">
			<h3>Tools</h3>
			<a id="drill" class="tool btn btn-large">Drill Press</a>
			<a id="mill" class="tool btn btn-large">Mill</a>
			<a id="saw" class="tool btn btn-large">Band Saw</a>
			<span id="sander" class="disabled-tool tool btn btn-large btn-inverse">Belt Sander</span>
			<span id="lathe" class="disabled-tool tool btn btn-large btn-inverse">Lathe</span>
		</div>

		<div class="span10">
			<div class="row">
				<div class="span3">
					<h3>Time Left: <span id="timerText"></span></h3>
				</div>
				<div class="span4">
					<br>
					<div id="timerBar" class="progress progress-striped active" style="height: 29px;">
						<div class="bar" style="width: 60%;"></div>
					</div>
				</div>
				<div class="span3">
					<br>
					<a class="btn btn-success" href="#" id="done">
						<i class="icon-ok icon-white"></i>&nbsp;
						I'm Done!
					</a>
				</div>
			</div>

			<div class="row">
				<div id="sandbox" class="span6">
					<h4>Workbench</h4>
					<!--canvas-->
					<div class="well">
						<label class="radius">Radius&nbsp; <input id="radius" type="text" class="span3" /></label>
						<label class="depth">Depth&nbsp; <input id="depth" type="text" class="span3" /></label>
						<label class="cutInverse">Cut Inverse&nbsp; <input type="checkbox" id="cutInverse" value="cutInverse" /></label>
					</div>
				</div>

				<div id="exhibit" class="span4">
					<h4>Sample</h4>
					<!--canvas-->
					<br><br>
					<a class="btn btn-info" href="#" id="gridToggle" data-state="hide">
						<i class="icon-th icon-white"></i>&nbsp;
						<span>Hide Grid</span>
					</a>
					<a class="btn btn-info" href="#" id="export">
						<i class="icon-download icon-white"></i>&nbsp;Download
					</a>
					<br><br>
					<a class="btn btn-danger" href="#" id="undo">
						<i class="icon-share-alt icon-white"></i>&nbsp;Undo
					</a>
					<a class="btn btn-danger" href="#" id="reset">
						<i class="icon-remove-circle icon-white"></i>&nbsp;Scrap
					</a>
					<br><br>
					<div class="btn-group">
						<button class="btn change-view" id="isometric">Isometric</button>
						<button class="btn change-view" id="top">Top</button>
						<button class="btn change-view" id="right">Right</button>
						<button class="btn change-view" id="front">Front</button>
					</div>
				</div>
			</div>
		</div>

	</div>

	<!-- <strong>Import:</strong> <input type="file" id="file" /> -->
	</div>

</div>

</body>

</html>